<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Globite - æ¯æ—¥ä¸€åœ‹</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px 0; }
        .card { background: white; width: 90%; max-width: 380px; border-radius: 28px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; text-align: center; }
        .image-container { width: 100%; height: 180px; background: #eee; cursor: pointer; position: relative; }
        .image-container img { width: 100%; height: 100%; object-fit: contain; }
        .image-container::after { content: "ğŸ”Š"; position: absolute; bottom: 10px; right: 10px; font-size: 20px; opacity: 0.6; }
        .content { padding: 20px; }
        .tag { display: inline-block; background: #f1f5f9; padding: 4px 12px; border-radius: 50px; font-size: 12px; color: #64748b; margin-bottom: 10px; }
        h1 { margin: 5px 0; font-size: 24px; color: #0f172a; line-height: 1.2; cursor: pointer; transition: color 0.2s; }
        h1:active { color: var(--primary); }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; text-align: left; }
        .info-item { background: #f8fafc; padding: 10px; border-radius: 12px; border: 1px solid #edf2f7; }
        .label { color: #94a3b8; font-size: 10px; display: block; }
        .value { font-weight: 600; color: #334155; font-size: 14px; }
        .capital-link { color: var(--primary); text-decoration: none; display: flex; align-items: center; gap: 4px; }
        .btn-group { display: flex; gap: 8px; margin-top: 10px; }
        button { flex: 1; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; }
        button.secondary { background: #f1f5f9; color: #475569; font-size: 14px; }
        .progress-control { margin-top: 20px; padding-top: 15px; border-top: 1px dashed #e2e8f0; }
        .progress-text { font-size: 11px; color: #94a3b8; margin-bottom: 8px; }
        .input-group { display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 5px; }
        input[type="number"] { width: 50px; padding: 6px; border: 1px solid #cbd5e1; border-radius: 8px; text-align: center; }
        .btn-sm { padding: 6px 10px; font-size: 11px; border-radius: 8px; background: #64748b; color: white; border: none; }
        .voice-opt { font-size: 12px; color: #64748b; margin-bottom: 8px; display: flex; justify-content: center; align-items: center; gap: 5px; }
    </style>
</head>
<body>

<div class="card">
    <div class="image-container" onclick="speakCountry()">
        <img id="flagImg" src="" alt="åœ‹æ——">
    </div>
    <div class="content">
        <div id="region" class="tag">-</div>
        <h1 id="countryName" onclick="speakCountry()">è¼‰å…¥ä¸­...</h1>
        
        <div class="info-grid">
            <div class="info-item">
                <span class="label">å®˜æ–¹é¦–éƒ½ (è·³è½‰åœ°åœ–)</span>
                <a id="capitalLink" href="#" target="_blank" class="capital-link">
                    <span id="capital" class="value">-</span> ğŸ“
                </a>
            </div>
            <div class="info-item">
                <span class="label">ä¼°è¨ˆäººå£</span>
                <span id="population" class="value">-</span>
            </div>
        </div>

        <div class="btn-group">
            <a id="wikiLink" href="#" target="_blank" style="flex:1"><button class="secondary">ç™¾ç§‘</button></a>
            <button onclick="nextCountry()" style="flex:1.5">ä¸‹ä¸€ç«™</button>
        </div>

        <div class="progress-control">
            <div class="voice-opt">
                <input type="checkbox" id="autoVoice" checked> 
                <label for="autoVoice">è‡ªå‹•æœ—è®€åœ‹å (EN)</label>
            </div>
            <div id="progressText" class="progress-text">é€²åº¦ï¼šè®€å–ä¸­...</div>
            <div class="input-group">
                <input type="number" id="targetIndex" placeholder="No.">
                <button class="btn-sm" onclick="jumpTo()">è·³è½‰</button>
                <button class="btn-sm" style="background:#ef4444" onclick="resetProgress()">é‡ç½®</button>
            </div>
        </div>
    </div>
</div>

<script>
    let allCountries = [];
    let currentIndex = 0;
    let currentEnName = "";

    const regionMap = { 'Asia': 'äºæ´²', 'Europe': 'æ­æ´²', 'Africa': 'éæ´²', 'Oceania': 'å¤§æ´‹æ´²', 'Americas': 'ç¾æ´²', 'Antarctica': 'å—æ¥µæ´²' };

    async function fetchCountries() {
        try {
            const response = await fetch('https://restcountries.com/v3.1/all?fields=name,translations,flags,continents,capital,population,maps');
            const data = await response.json();
            data.sort((a, b) => a.name.common.localeCompare(b.name.common));

            allCountries = data.map(c => ({
                zhName: c.translations?.zho?.common || c.name.common,
                enName: c.name.common,
                flag: c.flags.png,
                region: `${regionMap[c.continents[0]] || c.continents[0]} (${c.continents[0]})`,
                capital: c.capital ? c.capital[0] : 'ç„¡',
                population: c.population ? c.population.toLocaleString() : 'ä¸è©³',
                wiki: `https://zh.wikipedia.org/wiki/${c.translations?.zho?.common || c.name.common}`,
                capitalMap: `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent((c.capital ? c.capital[0] : '') + ' ' + c.name.common)}`
            }));

            const saved = localStorage.getItem('globite_idx');
            currentIndex = saved ? parseInt(saved) : 0;
            updateDisplay();
        } catch (e) { document.getElementById('countryName').innerText = "é€£ç·šå¤±æ•—"; }
    }

    function updateDisplay() {
        if (allCountries.length === 0) return;
        const c = allCountries[currentIndex];
        currentEnName = c.enName; // å„²å­˜è‹±æ–‡åç¨±ä¾›æœ—è®€

        document.getElementById('flagImg').src = c.flag;
        document.getElementById('region').innerText = c.region;
        document.getElementById('countryName').innerHTML = `${c.zhName}<br><span style="font-size:14px; color:#94a3b8; font-weight:normal;">${c.enName}</span>`;
        document.getElementById('capital').innerText = c.capital;
        document.getElementById('population').innerText = c.population;
        document.getElementById('wikiLink').href = c.wiki;
        document.getElementById('capitalLink').href = c.capitalMap;
        
        document.getElementById('progressText').innerText = `ç¬¬ ${currentIndex + 1} å€‹ / å…± ${allCountries.length} å€‹`;
        localStorage.setItem('globite_idx', currentIndex);

        // å¦‚æœå‹¾é¸è‡ªå‹•æœ—è®€ï¼Œå»¶é²ä¸€ä¸‹ä¸‹å¾Œæœ—è®€
        if (document.getElementById('autoVoice').checked) {
            setTimeout(speakCountry, 300);
        }
    }

    function speakCountry() {
        if (!currentEnName) return;
        const utterance = new SpeechSynthesisUtterance(currentEnName);
        utterance.lang = 'en-US';
        utterance.rate = 0.9; // ç¨å¾®æ”¾æ…¢ä¸€é»é»
        window.speechSynthesis.speak(utterance);
    }

    function nextCountry() {
        currentIndex = (currentIndex + 1) % allCountries.length;
        updateDisplay();
    }

    function jumpTo() {
        const val = parseInt(document.getElementById('targetIndex').value);
        if (val >= 1 && val <= allCountries.length) {
            currentIndex = val - 1;
            updateDisplay();
        }
    }

    function resetProgress() {
        if (confirm("è¦é‡ç½®é€²åº¦å—ï¼Ÿ")) {
            currentIndex = 0;
            updateDisplay();
        }
    }

    fetchCountries();
</script>

</body>
</html>