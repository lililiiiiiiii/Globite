<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Globite - æ¯æ—¥ä¸€åœ‹</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --dark: #1e293b; --yt-soft: #f87171; --gray-btn: #64748b; }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px 0; }
        .card { background: white; width: 90%; max-width: 380px; border-radius: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); overflow: hidden; text-align: center; }
        .image-container { width: 100%; height: 180px; background: #eee; cursor: pointer; position: relative; }
        .image-container img { width: 100%; height: 100%; object-fit: contain; }
        .image-container::after { content: "ğŸ”Š"; position: absolute; bottom: 10px; right: 10px; font-size: 20px; opacity: 0.5; }
        .content { padding: 24px; }
        
        /* Region æ¨™ç±¤å„ªåŒ–ï¼šç§»é™¤æ‹¬å¼§ï¼Œç©ºç™½å€éš” */
        .tag { display: inline-block; background: #f1f5f9; padding: 6px 18px; border-radius: 50px; font-size: 11px; color: #64748b; margin-bottom: 12px; font-weight: 500; letter-spacing: 0.3px; }
        
        h1 { margin: 5px 0; font-size: 26px; color: #0f172a; line-height: 1.1; cursor: pointer; letter-spacing: -0.5px; }
        .sub-info { font-size: 16px; color: #64748b; font-weight: 500; margin-top: 6px; }
        .pop-info { font-size: 12px; color: #94a3b8; margin-top: 4px; }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; text-align: left; }
        .info-item { background: #f8fafc; padding: 12px; border-radius: 16px; border: 1px solid #edf2f7; cursor: pointer; transition: background 0.2s; height: 85px; display: flex; flex-direction: column; justify-content: center; }
        .info-item:active { background: #f1f5f9; }
        .label { color: #94a3b8; font-size: 10px; display: block; margin-bottom: 4px; }
        .value { font-weight: 600; color: #334155; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .small-lang { font-size: 9px; color: #94a3b8; font-weight: normal; margin-top: 4px; line-height: 1.2; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 10px; align-items: stretch; }
        .btn-group a, .btn-group button { display: flex; align-items: center; justify-content: center; border-radius: 18px; border: none; cursor: pointer; transition: transform 0.1s, opacity 0.2s; text-decoration: none; }
        .btn-icon { width: 50px; height: 55px; background: #f1f5f9; font-size: 20px; flex-shrink: 0; } 
        .btn-main { flex-grow: 1; background: var(--dark); color: white; font-size: 17px; font-weight: 700; letter-spacing: 1px; }
        
        .progress-control { margin-top: 25px; padding-top: 20px; border-top: 1px dashed #e2e8f0; }
        .progress-text { font-size: 11px; color: #94a3b8; margin-bottom: 10px; }
        .input-group { display: flex; justify-content: center; align-items: center; gap: 6px; flex-wrap: wrap; }
        input[type="number"] { width: 42px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 10px; text-align: center; font-size: 12px; outline: none; }
        .btn-sm { padding: 9px 12px; font-size: 11px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; transition: opacity 0.2s; }
        .bg-gray { background: var(--gray-btn); color: white; }
        .bg-black { background: var(--dark); color: white; }
        .voice-opt { font-size: 12px; color: #64748b; margin-bottom: 12px; display: flex; justify-content: center; align-items: center; gap: 6px; }
    </style>
</head>
<body>

<div class="card">
    <div class="image-container" onclick="speakText(currentEnName, 'en-US')">
        <img id="flagImg" src="" alt="åœ‹æ——">
    </div>
    <div class="content">
        <div id="region" class="tag">LOADING</div>
        <h1 id="countryEn" onclick="speakText(currentEnName, 'en-US')">-</h1>
        <div id="countryZh" class="sub-info">-</div>
        <div id="countryPop" class="pop-info">ğŸ‘¥ -</div>
        
        <div class="info-grid">
            <div class="info-item" onclick="speakText(currentCapitalEn, 'en-US')">
                <span class="label">CAPITAL ğŸ”Š</span>
                <span id="capital" class="value" style="color:var(--primary)">-</span>
                <a id="capitalLink" href="#" target="_blank" style="font-size: 9px; text-decoration: none; color: #94a3b8; margin-top: 6px;">ğŸ“ VIEW MAP</a>
            </div>
            <div class="info-item" id="greetBox">
                <span class="label">GREETING ğŸ”Š</span>
                <span id="greeting" class="value">-</span>
                <div id="languages" class="small-lang">-</div>
            </div>
        </div>

        <div class="btn-group">
            <a id="wikiLink" href="#" target="_blank" class="btn-icon">ğŸ“–</a>
            <a id="ytLink" href="#" target="_blank" class="btn-icon"><span style="color:var(--yt-soft);">â–¶</span></a>
            <button onclick="nextCountry()" class="btn-main">å‡ºç™¼ï¼ä¸‹ä¸€ç«™</button>
        </div>

        <div class="progress-control">
            <div class="voice-opt">
                <input type="checkbox" id="autoVoice" checked> 
                <label for="autoVoice">è‡ªå‹•æœ—è®€åœ‹å</label>
            </div>
            <div id="progressText" class="progress-text">ç›®å‰åœ‹å®¶ï¼šè®€å–ä¸­...</div>
            <div class="input-group">
                <button class="btn-sm bg-gray" onclick="prevCountry()">è¿”å›</button>
                <input type="number" id="targetIndex" placeholder="No.">
                <button class="btn-sm bg-gray" onclick="jumpTo()">è·³è½‰</button>
                <button class="btn-sm bg-black" onclick="randomCountry()">ğŸ² éš¨æ©Ÿ</button>
                <button class="btn-sm bg-gray" onclick="resetProgress()" style="background:#cbd5e1; color:#475569;">é‡ç½®</button>
            </div>
        </div>
    </div>
</div>

<script>
    let allCountries = [];
    let currentIndex = 0;
    let currentEnName = "";
    let currentCapitalEn = "";

    const s2t = {"å›½":"åœ‹","é©¬":"é¦¬","æ¥":"ä¾†","äºš":"äº","æ–°":"æ–°","åŠ ":"åŠ ","å¡":"å¡","æ²™":"æ²™","ç‰¹":"ç‰¹","éŸ©":"éŸ“","æœ":"æœ","é²œ":"é®®","å¯®":"å¯®","è¶Š":"è¶Š","å—":"å—","ç¼…":"ç·¬","ç”¸":"ç”¸","è²":"è²","å¾‹":"å¾‹","å®¾":"è³“","å°":"å°","åº¦":"åº¦","å°¼":"å°¼","è¥¿":"è¥¿","å“ˆ":"å“ˆ","è¨":"è–©","å…‹":"å…‹","å‰":"å‰","å°”":"çˆ¾","æ–¯":"æ–¯","å¦":"å¦","å¡”":"å¡”","ä¹Œ":"çƒ","å…¹":"èŒ²","åˆ«":"åˆ¥","åœŸ":"åœŸ","åº“":"åº«","æ›¼":"æ›¼","ä¹Ÿ":"è‘‰","å™":"æ•˜","åˆ©äºš":"åˆ©äº","çº¦":"ç´„","æ—¦":"æ—¦","é»":"é»","ä»¥":"ä»¥","è‰²åˆ—":"è‰²åˆ—","å·´":"å·´","å‹’":"å‹’","æ–¯":"æ–¯","ä¼Š":"ä¼Š","æ‹‰å…‹":"æ‹‰å…‹","æœ—":"æœ—","å¾·":"å¾·","æ³•":"æ³•","ä¿„":"ä¿„","ç½—":"ç¾…","è‹±":"è‹±","ç¾":"ç¾","æ¾³æ´²":"æ¾³æ´²","æ¾³":"æ¾³","çº½":"ç´","å…°":"è˜­","è¥¿å…°":"è¥¿è˜­","ç¾¤å²›":"ç¾¤å³¶","æ–¯é‡Œ":"æ–¯é‡Œ","å…°å¡":"è˜­å¡","å­Ÿ":"å­Ÿ","åŠ æ‹‰":"åŠ æ‹‰","å°”":"çˆ¾","ä»£":"ä»£","å¤«":"å¤«","å‡ ":"å¹¾","å†…":"å…§","äºš":"äº","åœ£":"è–"};
    const regionNames = { 'Asia': 'äºæ´²', 'Europe': 'æ­æ´²', 'Africa': 'éæ´²', 'Oceania': 'å¤§æ´‹æ´²', 'Americas': 'ç¾æ´²', 'Antarctica': 'å—æ¥µæ´²', 'South-Eastern Asia': 'æ±å—äº', 'Central Asia': 'ä¸­äº', 'Western Asia': 'è¥¿äº', 'Eastern Asia': 'æ±äº', 'Southern Asia': 'å—äº', 'Northern Europe': 'åŒ—æ­', 'Southern Europe': 'å—æ­', 'Western Europe': 'è¥¿æ­', 'Eastern Europe': 'æ±æ­', 'Central Europe': 'ä¸­æ­', 'Northern Africa': 'åŒ—é', 'Western Africa': 'è¥¿è²»', 'Eastern Africa': 'æ±é', 'Middle Africa': 'ä¸­é', 'Southern Africa': 'å—é', 'North America': 'åŒ—ç¾æ´²', 'South America': 'å—ç¾æ´²', 'Central America': 'ä¸­ç¾æ´²', 'Caribbean': 'åŠ å‹’æ¯”æµ·åœ°å€' };

    function forceTC(str) {
        if (!str || str === "-") return "-";
        let res = str;
        Object.keys(s2t).forEach(k => { res = res.replace(new RegExp(k, 'g'), s2t[k]); });
        return res;
    }

    const languageGreetingMap = { 'zho': { word: "ä½ å¥½", lang: "zh-TW" }, 'eng': { word: "Hello", lang: "en-US" }, 'fra': { word: "Bonjour", lang: "fr-FR" }, 'spa': { word: "Hola", lang: "es-ES" }, 'jpn': { word: "ã“ã‚“ã«ã¡ã¯", lang: "ja-JP" }, 'kor': { word: "ì•ˆë…•í•˜ì„¸ìš”", lang: "ko-KR" }, 'deu': { word: "Guten Tag", lang: "de-DE" }, 'ita': { word: "Ciao", lang: "it-IT" }, 'tha': { word: "à¸ªà¸§à¸±à¸ªà¸”à¸µ", lang: "th-TH" }, 'vie': { word: "Xin chÃ o", lang: "vi-VN" }, 'rus': { word: "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚", lang: "ru-RU" }, 'por': { word: "OlÃ¡", lang: "pt-BR" }, 'ara': { word: "Ù…Ø±Ø­Ø¨Ø§Ù‹", lang: "ar-SA" }, 'hin': { word: "à¤¨à¤®à¤¸à¥à¤¤à¥‡", lang: "hi-IN" }, 'msa': { word: "Selamat", lang: "ms-MY" }, 'ind': { word: "Halo", lang: "id-ID" }, 'tur': { word: "Merhaba", lang: "tr-TR" }, 'nld': { word: "Hallo", lang: "nl-NL" }, 'ell': { word: "Î“ÎµÎ¹Î± ÏƒÎ±Ï‚", lang: "el-GR" }, 'dan': { word: "Hej", lang: "da-DK" }, 'swe': { word: "Hej", lang: "sv-SE" }, 'nor': { word: "Hallo", lang: "nb-NO" } };

    async function fetchCountries() {
        try {
            const response = await fetch('https://restcountries.com/v3.1/all?fields=name,translations,flags,continents,subregion,capital,languages,population');
            const data = await response.json();
            data.sort((a, b) => a.name.common.localeCompare(b.name.common));
            allCountries = data.map(c => {
                let zhRaw = c.translations?.zho?.common || c.name.common;
                let zh = forceTC(zhRaw);
                const en = c.name.common;
                const langList = c.languages ? Object.values(c.languages).join(', ') : '-';
                let greet = { word: "Hello", lang: "en-US" };
                if (c.languages) {
                    for (let key of Object.keys(c.languages)) {
                        if (languageGreetingMap[key]) { greet = languageGreetingMap[key]; break; }
                    }
                }
                
                // èª¿æ•´ Region é¡¯ç¤ºï¼šä¸­æ–‡ è‹±æ–‡ (ç„¡æ‹¬å¼§)
                let rawReg = c.subregion || c.continents[0];
                let displayRegion = regionNames[rawReg] ? `${regionNames[rawReg]} ${rawReg}` : forceTC(rawReg);

                return {
                    zhName: zh, enName: en, flag: c.flags.png,
                    region: displayRegion,
                    capital: forceTC(c.capital ? c.capital[0] : '-'),
                    population: c.population ? c.population.toLocaleString() : '-',
                    languages: forceTC(langList),
                    greet: greet,
                    wiki: `https://zh.wikipedia.org/wiki/${zh}`,
                    ytSearch: `https://www.youtube.com/results?search_query=${encodeURIComponent(en + ' ' + zh)}`,
                    capitalMap: `https://www.google.com/maps/search/${encodeURIComponent((c.capital ? c.capital[0] : '') + ' ' + en)}`
                };
            });
            const saved = localStorage.getItem('globite_idx');
            currentIndex = saved ? parseInt(saved) : 0;
            updateDisplay();
        } catch (e) { document.getElementById('countryEn').innerText = "ERROR"; }
    }

    function updateDisplay() {
        if (allCountries.length === 0) return;
        const c = allCountries[currentIndex];
        currentEnName = c.enName;
        currentCapitalEn = c.capital;
        document.getElementById('flagImg').src = c.flag;
        document.getElementById('region').innerText = c.region;
        document.getElementById('countryEn').innerText = c.enName;
        document.getElementById('countryZh').innerText = c.zhName;
        document.getElementById('countryPop').innerText = `ğŸ‘¥ ${c.population}`;
        document.getElementById('capital').innerText = c.capital;
        document.getElementById('greeting').innerText = c.greet.word;
        document.getElementById('languages').innerText = `ğŸ—£ ${c.languages}`;
        document.getElementById('capitalLink').href = c.capitalMap;
        document.getElementById('wikiLink').href = c.wiki;
        document.getElementById('ytLink').href = c.ytSearch;
        document.getElementById('progressText').innerText = `ç›®å‰åœ‹å®¶ï¼šç¬¬ ${currentIndex + 1} å€‹ / å…± ${allCountries.length} å€‹`;
        document.getElementById('greetBox').onclick = () => speakText(c.greet.word, c.greet.lang);
        localStorage.setItem('globite_idx', currentIndex);
        if (document.getElementById('autoVoice').checked) { setTimeout(() => speakText(currentEnName, 'en-US'), 300); }
    }

    function speakText(text, lang) {
        if (!text || text === '-') return;
        window.speechSynthesis.cancel(); 
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;
        utterance.rate = 0.85; 
        window.speechSynthesis.speak(utterance);
    }

    function nextCountry() { currentIndex = (currentIndex + 1) % allCountries.length; updateDisplay(); }
    function prevCountry() { currentIndex = (currentIndex - 1 + allCountries.length) % allCountries.length; updateDisplay(); }
    function randomCountry() { currentIndex = Math.floor(Math.random() * allCountries.length); updateDisplay(); }
    function jumpTo() {
        const input = document.getElementById('targetIndex');
        const val = parseInt(input.value);
        if (val >= 1 && val <= allCountries.length) { currentIndex = val - 1; updateDisplay(); input.value = ""; }
    }
    function resetProgress() { if (confirm("è¦é‡ç½®é€²åº¦å—ï¼Ÿ")) { currentIndex = 0; updateDisplay(); } }

    fetchCountries();
</script>
</body>
</html>
